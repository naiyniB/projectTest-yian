name: ğŸ”§ è‡ªåŠ¨è§£å‹ ZIP

# è§¦å‘æ¡ä»¶ï¼šå½“ uploads/ ç›®å½•ä¸‹çš„ zip æ–‡ä»¶è¢«æ›´æ–°
on:
  push:
    paths:
      - 'uploads/*.zip'

jobs:
  unzip:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # å…è®¸æäº¤æ›´æ”¹
      pull-requests: write

    steps:
      # 1. æ£€å‡ºä»“åº“ä»£ç 
      - name: ğŸ› æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      # 2. æŸ¥æ‰¾æœ€æ–°çš„ ZIP æ–‡ä»¶
      - name: ğŸ” æŸ¥æ‰¾ ZIP æ–‡ä»¶
        id: find-zip
        run: |
          ZIP_FILE=$(find uploads -name "*.zip" | sort -r | head -n 1)
          if [ -z "$ZIP_FILE" ]; then
            echo "âŒ æœªæ‰¾åˆ° ZIP æ–‡ä»¶"
            exit 1
          fi
          echo "ğŸ“„ æ‰¾åˆ° ZIP: $ZIP_FILE"
          echo "zip_file=$ZIP_FILE" >> $GITHUB_OUTPUT

      # 3. åˆ›å»ºè§£å‹ç›®å½•
      - name: ğŸ“‚ åˆ›å»ºè§£å‹ç›®å½•
        run: mkdir -p extracted

      # 4. è§£å‹ ZIP æ–‡ä»¶
      - name: ğŸ”§ è§£å‹æ–‡ä»¶
        run: |
          unzip -o -q "${{ steps.find-zip.outputs.zip_file }}" -d temp-extract/
          # å°†æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ° extracted/ ç›®å½•
          cp -rf temp-extract/* extracted/ || echo "âš ï¸ è§£å‹ç›®å½•ä¸ºç©ºæˆ–æ— å†…å®¹"
          rm -rf temp-extract/
        continue-on-error: false

      # 5. æäº¤è§£å‹åçš„æ–‡ä»¶åˆ°ä»“åº“
      - name: ğŸ“¤ æäº¤å¹¶æ¨é€åˆ° main åˆ†æ”¯
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add extracted/
          git status

          if git diff-index --quiet HEAD --; then
            echo "ğŸŸ¡ æ— æ›´æ”¹ï¼Œè·³è¿‡æäº¤"
          else
            git commit -m "âœ… è‡ªåŠ¨è§£å‹: ${{ steps.find-zip.outputs.zip_file }}"
            git push origin main
            echo "ğŸ‰ è§£å‹å®Œæˆå¹¶å·²æäº¤åˆ°ä»“åº“ï¼"
          fi
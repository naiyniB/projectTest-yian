---
import Layout from "@/layouts/Layout.astro";
import { rx } from "theme";
import { rxPage } from "@rxdrag/website-lib-core";
import { Meta, Tabs, TabsHeader, TabsTab, Flip, TabsBody, TabsPanel, RichTextView } from "@rxdrag/website-lib";
import { Medias, Share, AttachmentIcon } from "@rxdrag/website-lib-core";
import { Header, BreadcrumbCTA, Breadcrumb, EnquiryTrigger, Features, ProductCard, FooterCTA, Footer, Globals } from "theme";

// 生成静态路径
export async function getStaticPaths() {
  // 获取所有产品的静态路径
  return await rx.getProductPaths();
}
//export const prerender = false;
// 在组件加载时获取产品详情
const { slug } = Astro.params;
if (!slug) {
  return Astro.redirect("/404");
}
const product = await rx.getProductBySlug(slug, {
  width: 800,
  height: 800,
});
// 如果产品不存在，返回 404
if (!product) {
  return Astro.redirect("/404");
}
// 生成面包屑
const breadcrumbs = rxPage.productBreadcrumbs(product, "Home", "Products");---

<Layout>
  <Meta title={product?.title} content={product?.meta} slot="meta" />
  <Header />
  <BreadcrumbCTA title={product.title || "Product"} hideContact>
    Be trusted by customers <b>worldwide</b>.
  </BreadcrumbCTA>
  <Breadcrumb separator="/" items={breadcrumbs} />

  <main class="container">
    <section class="m-h-20 w-full mt-4">
      <div
        id="grid-1"
        class="container lg:grid lg:grid-cols-7 lg:grid-rows-1 lg:gap-x-8 lg:gap-y-10 xl:gap-x-16"
      >
        <div class="lg:col-span-4">
          <Medias value={product?.medias} client:load />
        </div>
        <div
          class="w-full mx-auto mt-14 max-w-2xl sm:mt-16 lg:col-span-3 lg:row-span-2 lg:mt-0 lg:max-w-none"
        >
          <div
            class="-mt-5 -ml-5 lg:scrolled top-24 p-5 bg-white lg:scrolled:shadow-lg lg:sticky rounded-md transition-all"
          >
            <h1 class="text-2xl font-bold tracking-tight text-gray-900">
              {product.title}
            </h1>
            <p class="mt-2 text-gray-500">
              {product.description}
            </p>
            <div class="mt-8 max-w-xs">
              <EnquiryTrigger
                class="flex w-full items-center justify-center rounded-md border border-transparent bg-sky-600 px-8 py-3 font-bold text-white hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 focus:ring-offset-gray-50"
                callToAction="产品详情">Ask for a quote</EnquiryTrigger
              >
            </div>
          </div>
          {
            !!product?.features?.length && (
              <div class="mt-5 border-t border-gray-200 pt-10">
                <h3 class="text-sm font-medium text-gray-900">Features</h3>
                <div class="prose prose-sm mt-4 text-gray-500">
                  <Features
                    class="flex flex-col gap-2 text-sm"
                    value={product?.features}
                  />
                </div>
              </div>
            )
          }
          <div class="mt-10 border-t border-gray-200 pt-10">
            <h3 class="text-sm font-medium text-gray-900">
              Quality guaranteed
            </h3>
            <p class="mt-4 text-sm text-gray-500">
              We ensure quality by conducting thorough inspections before
              shipping. You'll receive detailed inspection reports along with
              photos or videos for your review.
            </p>
          </div>
          <div class="mt-10 border-t border-gray-200 pt-10">
            <div class="text-sm font-medium text-gray-900 mb-4">Share</div>
          </div>
          <Share client:load />
        </div>
        <div
          class="mx-auto mt-16 w-full max-w-2xl lg:col-span-4 lg:mt-0 lg:max-w-none min-h-[300px]"
        >
          <Tabs class="flex flex-col">
            <TabsHeader
              class="tabs-header"
              flipTransition={{
                duration: 300,
                ease: "easeInOut",
              }}
            >
              <TabsTab class="tabs-tab selected">
                <span>More info</span>
                <Flip flipKey="tab-indicator" class="tab-indicator" />
              </TabsTab>
              <TabsTab class="tabs-tab">
                <span>Packaging</span>
                <Flip flipKey="tab-indicator" class="tab-indicator" />
              </TabsTab>
              <TabsTab class="tabs-tab">
                <span>Delivery</span>
                <Flip flipKey="tab-indicator" class="tab-indicator" />
              </TabsTab>
              {
                !!product?.attachments?.length && (
                  <TabsTab class="tabs-tab">
                    <span>Downloads</span>
                    <Flip flipKey="tab-indicator" class="tab-indicator" />
                  </TabsTab>
                )
              }
            </TabsHeader>
            <TabsBody>
              <TabsPanel class="tabs-panel" whileSelection="fade-up">
                <RichTextView
                  class="max-w-3xl prose mt-1"
                  value={product?.content}
                />
              </TabsPanel>
              <TabsPanel class="tabs-panel" whileSelection="fade-up">
                <RichTextView
                  class="max-w-3xl prose"
                  value={product?.content2}
                />
              </TabsPanel>
              <TabsPanel class="tabs-panel" whileSelection="fade-up">
                <div class="prose">
                  <h2 class="text-2xl text-black font-semibold">Delivery</h2>
                  <ul>
                    <li>
                      Payment term: T/T 30% in advance and T/T 70% against copy
                      of B/L. or 100% L/C at sight.
                    </li>
                    <li>
                      Shipment time: Within 3 weeks after confirming order.
                    </li>
                    <li>
                      We take photos of every stage of the process and can send
                      them to you. Before we ship the container, you will have
                      photos and lab test results.
                    </li>
                  </ul>
                </div>
                <div>
                  <div class="rounded-md bg-sky-50 p-4 py-8 mt-16 shadow">
                    <div class="flex">
                      <div class="flex-shrink-0">
                        <span class="text-sky-700">
                          <svg
                            aria-hidden="true"
                            class="h-6 w-6"
                            fill="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path
                              d="M7 20h4c0 1.1-.9 2-2 2s-2-.9-2-2m-2-1h8v-2H5zm11.5-9.5c0 3.82-2.66 5.86-3.77 6.5H5.27c-1.11-.64-3.77-2.68-3.77-6.5C1.5 5.36 4.86 2 9 2s7.5 3.36 7.5 7.5m-2 0C14.5 6.47 12.03 4 9 4S3.5 6.47 3.5 9.5c0 2.47 1.49 3.89 2.35 4.5h6.3c.86-.61 2.35-2.03 2.35-4.5m6.87-2.13L20 8l1.37.63L22 10l.63-1.37L24 8l-1.37-.63L22 6zM19 6l.94-2.06L22 3l-2.06-.94L19 0l-.94 2.06L16 3l2.06.94z"
                            ></path>
                          </svg>
                        </span>
                      </div>
                      <div class="ml-3">
                        <h3 class="font-bold text-sky-700">
                          Provide quality after-sale service once the container
                          is received.
                        </h3>
                        <div class="mt-2 text-sky-700 flex flex-col gap-4 pt-4">
                          <p class="flex gap-2">
                            <span class="h-6 w-6">
                              <svg
                                aria-hidden="true"
                                class="h-6 w-6"
                                fill="currentColor"
                                focusable="false"
                                viewBox="0 0 24 24"
                              >
                                <path
                                  d="M11 21h-1l1-7H7.5c-.88 0-.33-.75-.31-.78C8.48 10.94 10.42 7.54 13.01 3h1l-1 7h3.51c.4 0 .62.19.4.66C12.97 17.55 11 21 11 21"
                                ></path>
                              </svg>
                            </span>
                            <span>
                              In case the product is damaged, we will refund you
                              or resend a new packaging.
                            </span>
                          </p>
                          <p class="flex gap-2">
                            <span class="h-6 w-6">
                              <svg
                                aria-hidden="true"
                                class="h-6 w-6"
                                fill="currentColor"
                                focusable="false"
                                viewBox="0 0 24 24"
                              >
                                <path
                                  d="M11 21h-1l1-7H7.5c-.88 0-.33-.75-.31-.78C8.48 10.94 10.42 7.54 13.01 3h1l-1 7h3.51c.4 0 .62.19.4.66C12.97 17.55 11 21 11 21"
                                ></path>
                              </svg>
                            </span>
                            <span>
                              Also, if the goods are not as per your
                              specification, we will callback the container at
                              our cost, or compensate you as per our agreement.
                            </span>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </TabsPanel>
              {
                !!product?.attachments?.length && (
                  <TabsPanel class="tabs-panel" whileSelection="fade-up">
                    <h2 class="text-2xl text-black font-semibold">
                      Downloadable documents
                    </h2>
                    <ul class="mt-10 text-sm flex flex-col">
                      {product?.attachments?.map((attachment) => (
                        <li class="flex items-center justify-between py-4 border-b border-gray-200">
                          <a
                            class="hover:text-sky-600 flex items-center gap-1"
                            href={attachment?.url}
                            target="_blank"
                          >
                            <AttachmentIcon
                              className="h-6 w-6"
                              extName={attachment?.extName}
                            />
                            <span>{attachment?.name}</span>
                          </a>
                          <a
                            class="text-sky-600 hover:text-sky-400"
                            href={attachment?.url}
                            target="_blank"
                          >
                            <span>Download</span>
                          </a>
                        </li>
                      ))}
                    </ul>
                    <p class="mt-6 text-sm text-gray-500 italic flex items-center gap-2">
                      <span class="h-5 w-5">
                        <svg
                          aria-hidden="true"
                          class="h-5 w-5"
                          fill="currentColor"
                          focusable="false"
                          viewBox="0 0 24 24"
                        >
                          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
                        </svg>
                      </span>
                      <span>For the latest materials, please contact us</span>
                    </p>
                  </TabsPanel>
                )
              }
            </TabsBody>
          </Tabs>
        </div>
      </div>
    </section>
    {
      !!product?.related?.length && (
        <section class="m-h-20 w-full mt-8">
          <div class="container mx-auto mt-24 w-full lg:col-span-4 border-t py-6 pt-12">
            <div class="flex justify-center">
              <h2 class="block-title">Related Products</h2>
            </div>
            <div class="grid grid-cols-4 mt-10 gap-4">
              {product?.related?.map((related) => (
                <ProductCard product={related} ctaTitle="Get a quote" />
              ))}
            </div>
          </div>
        </section>
      )
    }
  </main>

  <FooterCTA />
  <Footer />
  <Globals />
</Layout>

<style>
  .tab-indicator {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: #0070f3;
    border-radius: 1px;
    transition: opacity 0.3s ease;
  }

  .tabs-tab {
    position: relative;
    padding-bottom: 4px;
  }
</style>

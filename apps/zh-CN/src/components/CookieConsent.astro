---
  import "vanilla-cookieconsent/dist/cookieconsent.css";
  import "../styles/CookieConsent.css";
  ---
  
  <script>
    import { run } from "vanilla-cookieconsent";
    import { config, grantGa } from "./CookieConsentConfig";
    import { shouldShowCookieConsent } from "../utils/geoLocation";
  
    // 异步初始化Cookie同意逻辑
    async function initializeCookieConsent() {
      try {
        const showConsent = await shouldShowCookieConsent();
  
        if (showConsent) {
          // 显示Cookie同意UI
          document.body.classList.add("cc--elegant-black");
          run(config);
  
          // 显示偏好设置按钮
          const preferencesBtn = document.getElementById("show-preferences-btn");
          if (preferencesBtn) {
            preferencesBtn.style.display = "block";
          }
        } else {
          // 直接加载GA，不显示同意UI
          grantGa();
          console.log("非欧洲地区，直接加载Google Analytics");
        }
      } catch (error) {
        console.error("Cookie同意初始化失败:", error);
        // 出错时默认显示同意UI（安全策略）
        document.body.classList.add("cc--elegant-black");
        run(config);
  
        const preferencesBtn = document.getElementById("show-preferences-btn");
        if (preferencesBtn) {
          preferencesBtn.style.display = "block";
        }
      }
    }
  
    // 页面加载完成后初始化
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initializeCookieConsent);
    } else {
      initializeCookieConsent();
    }
  </script>
  